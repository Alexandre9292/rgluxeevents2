{% extends 'base.html' %}
{% load static %}

{% block title %}RG Luxe Events - Photobooth{% endblock %}

{% block content %}
<!-- Banner principal avec l'image back_ban.jpg √©tir√©e sur toute la largeur -->
<div class="hero-banner">
    <div class="banner-background">
        <img src="{% static 'images/back_ban.jpg' %}" alt="Banni√®re RG Luxe Events">
    </div>
    
    <div class="banner-content">
        <div class="banner-left">
            <div class="transport-panel">
                <div class="transport-image diamond1">
                    <a href="{% url 'transport' %}">
                        <img src="{% static 'images/transport_ban.png' %}" alt="Transport de luxe">
                    </a>
                </div>
            </div>
        </div>

        <div class="banner-center">
            <div class="drone-panel">
                <div class="drone-image diamond2">                    
                    <a href="{% url 'drone' %}">
                        <img src="{% static 'images/drone_ban.png' %}" alt="Services drone">
                    </a>
                </div>
                <!-- Logo d√©plac√© en dehors du conteneur avec overflow: hidden -->
                <div class="logo-overlay">
                    <a href="{% url 'home' %}">
                        <img src="{% static 'images/logo_ban.jpg' %}" alt="Logo RG Luxe Events" id="drone-image">
                    </a>
                </div>
            </div>
        </div>

        <div class="banner-right">
            <div class="photobooth-panel">
                <div class="photobooth-image diamond1">                  
                    <a href="{% url 'photobooth' %}">
                        <img src="{% static 'images/photobooth_ban.png' %}" alt="Photobooth">
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Image banni√®re haute -->
<div class="ban-haut" style="display: none;">
    <img src="{% static 'images/ban_haut.jpg' %}" alt="Banni√®re RG Luxe Events">
</div>

<!-- Section de pr√©sentation du service -->
<section class="service-presentation-section">
    <div class="container">
        <div class="service-content">
            <h2>Location Photobooth</h2>
            <p class="service-intro">Cr√©ez l'√©ffet "WOUAH" √† votre √©v√©nement !</p>
            <p class="service-description">Avec notre PHOTOBOOTH, offrez √† vos invit√©s des poses d√©jant√©es, des fous rires, des clich√©s √†
                imprimer ou √† partager sur les r√©seaux sociaux ...</p>
            <p class="service-description">Mariage, anniversaire, baby-shower, soir√©e priv√©e, ou divers √©v√©nements</p>
        </div>
    </div>
</section>

<!-- Section du formulaire de r√©servation -->
<section class="photobooth-booking-section">
    <div class="container">
        <div class="booking-form-container">
            <h2>R√©servation</h2>
            <form method="post" class="booking-form" id="photobooth-form">
                {% csrf_token %}
                
                <!-- Champs cach√©s pour stocker les donn√©es de calcul -->
                <input type="hidden" id="calculated-price" name="calculated_price" value="0">
                <input type="hidden" id="calculated-acompte" name="calculated_acompte" value="100">
                <input type="hidden" id="calculated-reste" name="calculated_reste" value="0">
                
                <div class="form-row">
                    <div class="form-group">
                        {{ form.service_type.label_tag }}
                        {{ form.service_type }}
                    </div>
                    <div class="form-group" id="hours-fields" style="display: none;">
                        {{ form.hours.label_tag }}
                        {{ form.hours }}
                    </div>
                    <div class="form-group" id="days-fields" style="display: none;">
                        {{ form.days.label_tag }}
                        {{ form.days }}
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        {{ form.event_date.label_tag }}
                        {{ form.event_date }}
                    </div>
                    <div class="form-group">
                        {{ form.event_time.label_tag }}
                        {{ form.event_time }}
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="location">Lieu :</label>
                        <select name="location" id="location" required>
                            <option value="">S√©lectionnez une commune</option>
                            <option value="Avirons (Les)">Avirons (Les)</option>
                            <option value="Bras-Panon">Bras-Panon</option>
                            <option value="Cilaos">Cilaos</option>
                            <option value="Entre-Deux">Entre-Deux</option>
                            <option value="√âtang-Sal√©">√âtang-Sal√©</option>
                            <option value="Petite-√éle">Petite-√éle</option>
                            <option value="Plaine-des-Palmistes (La)">Plaine-des-Palmistes (La)</option>
                            <option value="Possession (La)">Possession (La)</option>
                            <option value="Port (Le)">Port (Le)</option>
                            <option value="Saint-Andr√©">Saint-Andr√©</option>
                            <option value="Saint-Beno√Æt">Saint-Beno√Æt</option>
                            <option value="Saint-Denis">Saint-Denis</option>
                            <option value="Saint-Joseph">Saint-Joseph</option>
                            <option value="Saint-Leu">Saint-Leu</option>
                            <option value="Saint-Louis">Saint-Louis</option>
                            <option value="Saint-Paul">Saint-Paul</option>
                            <option value="Saint-Philippe">Saint-Philippe</option>
                            <option value="Saint-Pierre">Saint-Pierre</option>
                            <option value="Sainte-Marie">Sainte-Marie</option>
                            <option value="Sainte-Rose">Sainte-Rose</option>
                            <option value="Sainte-Suzanne">Sainte-Suzanne</option>
                            <option value="Salazie">Salazie</option>
                            <option value="Tampon (Le)">Tampon (Le)</option>
                            <option value="Trois-Bassins">Trois-Bassins</option>
                        </select>
                    </div>
                    <div class="form-group">
                        {{ form.event_type.label_tag }}
                        {{ form.event_type }}
                    </div>
                </div>
                
                <!-- Affichage du prix -->
                <div class="price-display" id="price-display" style="display: none;">
                    <div class="price-details">
                        <div class="price-row">
                            <div class="price-label">Prix total :</div>
                            <div class="price-value" id="price-value">0‚Ç¨</div>
                        </div>
                        <div class="price-row">
                            <div class="price-label">Acompte :</div>
                            <div class="price-acompte">100‚Ç¨</div>
                        </div>
                        <div class="price-row total-row">
                            <div class="price-label">Reste √† payer :</div>
                            <div class="price-reste" id="price-reste">0‚Ç¨</div>
                        </div>
                    </div>
                </div>
                
                <button type="submit" class="btn btn-primary" id="submit-btn" style="display: none;">Suivant</button>
                
                <!-- Lien vers les conditions g√©n√©rales -->
                <div class="terms-conditions">
                    <a href="{% url 'photobooth_terms' %}" class="terms-link">CONDITIONS GENERALES DE LOCATION</a>
                </div>
            </form>
        </div>
    </div>
</section>

<!-- Section de pr√©sentation compl√®te du service -->
<section class="service-presentation-section">
    <div class="container">
        <div class="service-content">
            <p style="font-weight: bold;font-size: 30px;">Inclus dans toutes les formules :</p>
            <br><br><br>
            <div class="service-features">
                <div class="feature">
                    <i class="feature-icon">üì∏</i>
                    <h4>Haute qualit√©</h4>
                    <p>Tirage photo illimit√© avec impression instantan√©e en format 10x15cm ou 15x10cm</p>
                    <p>Personnalisation de l'√©cran de la machine</p>
                    <p>Personnalisation du cadre photo aux couleurs de votre √©v√©nement</p>
                </div>
                
                <div class="feature">
                    <i class="feature-icon">üíæ</i>
                    <h4>Partage num√©rique</h4>
                    <p>Galerie photo en ligne</p>
                    <p>Envoi photo par e-mail</p>
                </div>
                
                <div class="feature">
                    <i class="feature-icon">üé≠</i>
                    <h4>Accessoires inclus</h4>
                    <p>Accessoires de d√©guisements ( lunettes, chapeaux, masques,...)</p>
                </div>
                
                <div class="feature">
                    <i class="feature-icon">üöõ</i>
                    <h4>Service assistance</h4>
                    <p>livraison, installation et r√©cup√©ration de la machine</p>
                </div>
            </div>
            
            <div class="pricing-container">
                <div class="pricing-info">
                    <h4>Tarifs particuliers</h4>
                    <p>Choisissez la formule qui vous convient :</p>
                    <ul>
                        <li><strong>√Ä la journ√©e/soir√©e :</strong> secteur Est √† 395,00‚Ç¨ et secteur Nord / Ouest / Sud √†
                            450,00‚Ç¨<br><span style="font-style: italic;">profitez-en du d√©but √† la fin de votre √©v√©nement, sans limite !</span></li>
                        <li><strong>√Ä l'heure :</strong> 79,90‚Ç¨/heure (minimum 2h)
                            <br><span style="font-style: italic;">id√©al pour un √©v√©nement court ou un moment cl√© de votre soir√©e.</span></li>
                    </ul>
                </div>
                <div class="pricing-info">
                    <h4>Tarifs professionnels</h4>
                    <p>Solutions adapt√©es √† vos besoins :</p>
                    <ul>
                        <li><strong>Location longue dur√©e :</strong> 400,00‚Ç¨ / jour ( dur√©e de 10h00) - tarif d√©gressif selon le nombre
                            de jour<br><span style="font-style: italic;">Pour une utilisation sur plusieurs jours ou semaines (foires, animations permanentes,
                                campagnes marketing).</span></li>
                        <li><strong>Location √† l'√©v√©nement :</strong> 85‚Ç¨/heure ou 490,00‚Ç¨ ( dur√©e de 7h00)
                            <br><span style="font-style: italic;">Pour vos salons, s√©minaires, inaugurations ou op√©rations commerciales.</span></li>
                    </ul>
                    <p>Pour un devis ou tout autre information, n'h√©sitez pas √† <br><a href="{% url 'contact' %}" style="color: var(--primary-color);">nous contacter</a>.</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Messages de succ√®s/erreur -->
{% if messages %}
<div class="messages-container">
    {% for message in messages %}
    <div class="message {% if message.tags %}message-{{ message.tags }}{% endif %}">
        {{ message }}
    </div>
    {% endfor %}
</div>
{% endif %}

<script>
document.addEventListener('DOMContentLoaded', function() {
    const serviceTypeSelect = document.getElementById('id_service_type');
    const hoursFields = document.getElementById('hours-fields');
    const daysFields = document.getElementById('days-fields');
    const priceValue = document.getElementById('price-value');
    const priceReste = document.getElementById('price-reste');
    const submitBtn = document.getElementById('submit-btn');
    
    // Gestion de l'affichage des champs selon le type de service
    function updateFields() {
        const selectedValue = serviceTypeSelect.value;
        
        if (selectedValue === 'heure') {
            hoursFields.style.display = 'flex';
            daysFields.style.display = 'none';
        } else if (selectedValue === 'journee') {
            hoursFields.style.display = 'none';
            daysFields.style.display = 'flex';
        } else {
            hoursFields.style.display = 'none';
            daysFields.style.display = 'none';
        }
        
        calculatePrice();
    }
    
    // Calcul du prix
    function calculatePrice() {
        const serviceType = serviceTypeSelect.value;
        const location = document.getElementById('location').value;
        const hoursInput = document.getElementById('id_hours');
        const daysInput = document.getElementById('id_days');
        
        let totalPrice = 0;
        
        if (serviceType === 'heure' && hoursInput) {
            const hours = parseInt(hoursInput.value) || 0;
            if (hours >= 2) {
                totalPrice = hours * 79.90;
            }
        } else if (serviceType === 'journee' && daysInput) {
            const days = parseInt(daysInput.value) || 0;
            if (days >= 1) {
                // Tarifs selon la commune
                const eastCommunes = ['Saint-Andr√©', 'Bras-Panon', 'Saint-Beno√Æt', 'Sainte-Rose', 'Sainte-Suzanne', 'Sainte-Marie', 'Salazie'];
                if (eastCommunes.includes(location)) {
                    totalPrice = days * 395;
                } else {
                    totalPrice = days * 450;
                }
            }
        }
        
        // Afficher le prix seulement si toutes les conditions sont remplies
        const priceDisplay = document.getElementById('price-display');
        const submitBtn = document.getElementById('submit-btn');
        
        if (totalPrice > 0 && location) {
            priceDisplay.style.display = 'block';
            submitBtn.style.display = 'block';
            
            // Mettre √† jour les valeurs affich√©es
            document.getElementById('price-value').textContent = totalPrice.toFixed(2) + '‚Ç¨';
            document.getElementById('price-reste').textContent = (totalPrice - 100).toFixed(2) + '‚Ç¨';
            
            // Mettre √† jour les champs cach√©s
            document.getElementById('calculated-price').value = totalPrice.toFixed(2);
            document.getElementById('calculated-reste').value = (totalPrice - 100).toFixed(2);
        } else {
            priceDisplay.style.display = 'none';
            submitBtn.style.display = 'none';
        }
    }
    
    // Fonction pour remplir automatiquement la ville selon le code postal
    function autoFillCity(postalCode) {
        const citySelect = document.getElementById('location');
        
        // Mapping des codes postaux vers les villes
        const postalCodeMap = {
            '97400': 'Saint-Denis',
            '97410': 'Saint-Paul',
            '97420': 'Le Port',
            '97430': 'Le Tampon',
            '97440': 'Saint-Andr√©',
            '97450': 'Saint-Louis',
            '97460': 'Saint-Pierre',
            '97470': 'Saint-Beno√Æt',
            '97480': 'Saint-Joseph',
            '97490': 'Saint-Philippe',
            '97411': 'La Possession',
            '97412': 'Saint-Gilles-les-Bains',
            '97413': 'Saint-Leu',
            '97414': 'Cilaos',
            '97415': 'Entre-Deux',
            '97416': 'Petite-√éle',
            '97417': 'Saint-Philippe',
            '97418': 'Sainte-Rose',
            '97419': 'Salazie',
            '97421': 'Les Avirons',
            '97422': 'Bras-Panon',
            '97423': 'Sainte-Marie',
            '97424': 'Sainte-Suzanne',
            '97425': '√âtang-Sal√©',
            '97426': 'La Plaine-des-Palmistes',
            '97427': 'Trois-Bassins'
        };
        
        if (postalCodeMap[postalCode]) {
            citySelect.value = postalCodeMap[postalCode];
            // D√©clencher le calcul du prix
            calculatePrice();
        }
    }
    
    // √âv√©nements
    serviceTypeSelect.addEventListener('change', updateFields);
    
    const hoursInput = document.getElementById('id_hours');
    const daysInput = document.getElementById('id_days');
    const locationSelect = document.getElementById('location');
    
    if (hoursInput) {
        hoursInput.addEventListener('input', calculatePrice);
    }
    
    if (daysInput) {
        daysInput.addEventListener('input', calculatePrice);
    }
    
    if (locationSelect) {
        locationSelect.addEventListener('change', calculatePrice);
    }
    
    // Initialisation
    updateFields();
    
    // Bloquer les dates ant√©rieures √† aujourd'hui
    const eventDateInput = document.getElementById('id_event_date');
    if (eventDateInput) {
        const today = new Date().toISOString().split('T')[0];
        eventDateInput.setAttribute('min', today);
        
        // Validation suppl√©mentaire c√¥t√© client
        eventDateInput.addEventListener('change', function() {
            const selectedDate = new Date(this.value);
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            if (selectedDate < today) {
                alert('Veuillez s√©lectionner une date future.');
                this.value = '';
            }
        });
    }
    
    // Gestion de la soumission du formulaire
    document.getElementById('photobooth-form').addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Stocker les donn√©es dans localStorage pour la r√©cup√©ration sur la page de validation
        localStorage.setItem('photobooth_booking', JSON.stringify({
            location: document.getElementById('location').value,
            service_type: document.getElementById('id_service_type').value,
            hours: document.getElementById('id_hours').value || '',
            days: document.getElementById('id_days').value || '',
            event_date: document.getElementById('id_event_date').value,
            event_time: document.getElementById('id_event_time').value,
            event_type: document.getElementById('id_event_type').value,
            total_price: document.getElementById('calculated-price').value,
            acompte: document.getElementById('calculated-acompte').value,
            reste: document.getElementById('calculated-reste').value
        }));
        
        // Rediriger vers la page de validation
        window.location.href = "{% url 'photobooth_validation' %}";
    });
});
</script>
{% endblock %} 